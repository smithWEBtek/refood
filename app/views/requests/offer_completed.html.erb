<%= render 'layouts/flash_message' %>

<h1>Completed requests for:</h1>
<h3><%= link_to @offer.headline, offer_path(@offer) %></h3>
<div class="small">You posted on <%= format_date(@offer.created_at.localtime) %></div>

<br>
<% if @requests.present? %>
  <ul class="list-group">
    <% @requests.each do |request| %>
      <li class="list-group-item lt-grey-box">
        <b>Message: </b><%= request.message %><br>
        <b>From: </b><%= request.user.name %><br>
        <% if request.requestor_email.present? %>
          <b>Email: </b><%= request.requestor_email %><br>
        <% end %>
        <% if request.requestor_phone.present? %>
          <b>Phone: </b><%= format_phone(request.requestor_phone) %><br>
        <% end %>
        <b>Request date: </b><%= format_date(request.created_at.localtime) %><br>
        <br>
        <% if @offer.comments.find {|c| c.requestor_id == request.user.id} %>
          <% comment = @offer.comments.find {|c| c.requestor_id == request.user.id} %>
          <b>Your comment: </b><%= comment.comment_for_requestor %>
        <% else %>
          <%= form_for request, url: "/request/#{request.id}" do |f| %>
            <%= f.hidden_field :completed, value: true %>
            <%= fields_for @comment do |ff| %>
              <%= ff.text_field :comment_for_requestor, class: "form-control", placeholder: "Leave a comment for #{request.user.name}" %>
              <%= ff.hidden_field :offer_id, value: @offer.id.to_i %>
            <% end %>
            <%= f.submit "Submit", :class => "btn btn-outline-success" %>
          <% end %>
        <% end %>
      </li>
    <% end %>
  </ul>

  <br>
  <%= link_to "Open requests", offer_requests_path %>

<% else %>
  <br>
  <h5>Currently no completed requests</h5>
<% end %>

<br>
<%= link_to "Back to index", '/index' %>
